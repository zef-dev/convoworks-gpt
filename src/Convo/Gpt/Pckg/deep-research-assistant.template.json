{
    "template_id": "deep-research-assistant",
    "name": "Deep Research Assistant",
    "description": "An AI powered assistant that automates iterative web searches, extracts actionable insights, and produces a structured Markdown report.",
    "service": {
        "convo_service_version": 40,
        "packages": [
            "convo-core",
            "convo-gpt",
            "convo-wp-core"
        ],
        "contexts": [],
        "variables": {
            "GPT_API_KEY": "sk-",
            "DEFAULT_TEMPERATURE": "${0.1}",
            "DEFAULT_MAX_TOKENS": "${12000}",
            "DEFAULT_MODEL": "o3-mini",
            "REASONING_EFFORT": "medium",
            "MAX_MESSAGES_TOKENS": "${100000}",
            "TRUNCATE_TO_TOKENS": "${40000}",
            "MAX_FUNCTION_RESULT_SIZE": "${8192}",
            "DEFAULT_UTIL_MODEL": "gpt-4o-mini",
            "FIRECRAWL_API_BASE_URL": "https:\/\/api.firecrawl.dev",
            "FIRECRAWL_API_KEY": "fc-",
            "SEARCH_RESULTS_COUNT": "${5}",
            "DEFAULT_BREATH": "${4}",
            "DEFAULT_DEPTH": "${2}",
            "REPORT_POST_TYPE": "post",
            "REPORT_POST_STATUS": "draft",
            "MAX_EXECUTION_TIME": "${3000}",
            "MAX_TOKENS": "${100000}"
        },
        "preview_variables": [],
        "entities": [],
        "intents": [],
        "blocks": [
            {
                "class": "\\Convo\\Pckg\\Core\\Elements\\ConversationBlock",
                "namespace": "convo-core",
                "properties": {
                    "block_id": "3977ff45-8e2f-4fb8-a00b-e24c391ce323",
                    "role": "conversation_block",
                    "name": "Home",
                    "elements": [
                        {
                            "class": "\\Convo\\Pckg\\Core\\Elements\\ReadElementsFragment",
                            "namespace": "convo-core",
                            "properties": {
                                "fragment_id": "Inc_Check_API_Key",
                                "_component_id": "cveakoja-56ai-aody-gied-dl9fgehdwcal"
                            }
                        },
                        {
                            "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                            "namespace": "convo-core",
                            "properties": {
                                "scope_type": "request",
                                "parameters": "service",
                                "properties": {
                                    "WELCOME": "What would you like to research?"
                                },
                                "_component_id": "grhrbuxx-givj-yq3k-j2oh-61brvqhhib3e"
                            }
                        },
                        {
                            "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                            "namespace": "convo-core",
                            "properties": {
                                "scope_type": "session",
                                "parameters": "service",
                                "properties": {
                                    "messages": "${[{\"role\": \"assistant\", \"content\": WELCOME}]}"
                                },
                                "_component_id": "ku1iy4s7-rkrj-jw2i-dd2g-t5n4acledmhz"
                            }
                        },
                        {
                            "class": "\\Convo\\Pckg\\Core\\Elements\\TextResponseElement",
                            "namespace": "convo-core",
                            "properties": {
                                "type": "default",
                                "text": "${WELCOME}",
                                "append": false,
                                "alexa_domain": "normal",
                                "alexa_emotion": "neutral",
                                "alexa_emotion_intensity": "medium",
                                "_component_id": "g0o1gc6v-ink1-ovka-ree5-lr7xhmbvr77n"
                            }
                        }
                    ],
                    "processors": [
                        {
                            "class": "\\Convo\\Pckg\\Core\\Processors\\SimpleProcessor",
                            "namespace": "convo-core",
                            "properties": {
                                "name": "Chat App",
                                "ok": [
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\ReadElementsFragment",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "fragment_id": "Inc_Check_API_Key",
                                            "_component_id": "rngde1aw-pah1-jrz7-o5vq-ayxdc8xmnaue"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\ReadElementsFragment",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "fragment_id": "Inc_Functions",
                                            "_component_id": "sq2vvtrw-ko39-tjza-2eel-w8wcuipb0pje"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "scope_type": "session",
                                            "parameters": "service",
                                            "properties": {
                                                "messages": "${array_merge( messages, [{\"role\": \"user\", \"content\": trim( request.text)}])}"
                                            },
                                            "_component_id": "incqqcd1-sl0c-qrhe-rovv-fkoihkw1uvyq"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\ReadElementsFragment",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "fragment_id": "Chat_Completion",
                                            "_component_id": "p2pvtnjf-awyq-925g-kiam-oa2r4x3ozav6"
                                        }
                                    }
                                ],
                                "request_filters": [
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Filters\\NopRequestFilter",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "empty": "match",
                                            "values": [],
                                            "_component_id": "hebve7se-qias-siwq-m1vq-h9vxempsezh6"
                                        }
                                    }
                                ],
                                "_component_id": "653ntuwl-bvk1-cnzu-45nj-ll3bq6sefm7t"
                            }
                        }
                    ],
                    "fallback": [],
                    "_component_id": "0f89fe24-f387-452e-b492-d120b77f32e0"
                }
            },
            {
                "class": "\\Convo\\Pckg\\Core\\Elements\\ConversationBlock",
                "namespace": "convo-core",
                "properties": {
                    "role": "error_handler",
                    "block_id": "Error_handler",
                    "name": "Error handler",
                    "pre_dispatch": [],
                    "elements": [
                        {
                            "class": "\\Convo\\Pckg\\Core\\Elements\\TextResponseElement",
                            "namespace": "convo-core",
                            "properties": {
                                "type": "default",
                                "text": "Error occurred. ${error.getMessage()}",
                                "append": false,
                                "alexa_domain": "normal",
                                "alexa_emotion": "neutral",
                                "alexa_emotion_intensity": "medium",
                                "_component_id": "agqkkd4i-xhos-jz7n-fuwo-yxb0ahv2rpuk"
                            }
                        }
                    ],
                    "processors": [],
                    "fallback": [],
                    "_component_id": "ofghljir-8yji-ddv7-a290-emljnn5sgmcp"
                }
            }
        ],
        "fragments": [
            {
                "class": "\\Convo\\Pckg\\Core\\Elements\\ElementsFragment",
                "namespace": "convo-core",
                "properties": {
                    "fragment_id": "Chat_Completion",
                    "name": "Chat Completion",
                    "elements": [
                        {
                            "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                            "namespace": "convo-core",
                            "properties": {
                                "scope_type": "request",
                                "parameters": "service",
                                "properties": {
                                    "user": "${wp_get_current_user()}",
                                    "ret": "${set_time_limit(MAX_EXECUTION_TIME)}"
                                },
                                "_component_id": "svkhergn-v9cc-vqcy-rmmk-r8r4gmf9nsjh"
                            }
                        },
                        {
                            "class": "\\Convo\\Gpt\\Pckg\\ChatCompletionV2Element",
                            "namespace": "convo-gpt",
                            "properties": {
                                "result_var": "status",
                                "api_key": "${GPT_API_KEY}",
                                "apiOptions": {
                                    "model": "${DEFAULT_MODEL}",
                                    "reasoning_effort": "${REASONING_EFFORT}"
                                },
                                "ok": [],
                                "_component_id": "rcb23gtx-fptt-m4oa-5t8z-auwr1pi6cgfw",
                                "functions": [],
                                "message_provider": [
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\IfElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "test": "${true}",
                                            "then": [
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\ReadElementsFragment",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "fragment_id": "Chat_Context_Main_Prompt",
                                                        "_component_id": "xo83rqr7-gznv-3lgg-2ohm-7hjets6gillg"
                                                    }
                                                },
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\ReadElementsFragment",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "fragment_id": "Chat_Context_System_Information",
                                                        "_component_id": "af90myez-tpjc-t5at-z3rd-g1mhngpswi6n"
                                                    }
                                                },
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\ReadElementsFragment",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "fragment_id": "Chat_Context_Functions",
                                                        "_component_id": "4lyouuku-ksde-wzch-fyvi-gvokpdifr7fr"
                                                    }
                                                }
                                            ],
                                            "else_if": [],
                                            "else": [],
                                            "_component_id": "olecamud-t0ww-oqpq-l3ij-pueikajktgcb"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\ReadElementsFragment",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "fragment_id": "Chat_Context_Deep_Research",
                                            "_component_id": "oahld6tu-6m8r-foci-d8qq-ubyzhkh2pxjh"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Gpt\\Pckg\\SimpleMessagesLimiterElement",
                                        "namespace": "convo-gpt",
                                        "properties": {
                                            "message_provider": [
                                                {
                                                    "class": "\\Convo\\Gpt\\Pckg\\ConversationMessagesElement",
                                                    "namespace": "convo-gpt",
                                                    "properties": {
                                                        "messages": "${messages}",
                                                        "_component_id": "7ais28yz-ad4o-vu32-8qko-s2d6y1cbsqac"
                                                    }
                                                }
                                            ],
                                            "_component_id": "xshgptwh-9nmy-7ii3-9a8z-ieyv6vylftjv",
                                            "truncated_flow": [
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "scope_type": "session",
                                                        "parameters": "service",
                                                        "properties": {
                                                            "messages": "${status.messages}"
                                                        },
                                                        "_component_id": "fgwycrzl-taxx-ac70-hqvc-uqalw5rhdiax"
                                                    }
                                                }
                                            ],
                                            "result_var": "status",
                                            "max_tokens": "${MAX_MESSAGES_TOKENS}",
                                            "truncate_to_tokens": "${TRUNCATE_TO_TOKENS}"
                                        }
                                    }
                                ],
                                "new_message_flow": [
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\IfElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "test": "${status.last_message.tool_calls}",
                                            "then": [
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\IfElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "test": "${status.last_message.content}",
                                                        "then": [
                                                            {
                                                                "class": "\\Convo\\Pckg\\Core\\Elements\\TextResponseElement",
                                                                "namespace": "convo-core",
                                                                "properties": {
                                                                    "type": "default",
                                                                    "text": "${status.last_message.content}",
                                                                    "append": false,
                                                                    "alexa_domain": "normal",
                                                                    "alexa_emotion": "neutral",
                                                                    "alexa_emotion_intensity": "medium",
                                                                    "_component_id": "vzmwwgum-omq0-i55p-mnkw-hlslayr1jwlc"
                                                                }
                                                            }
                                                        ],
                                                        "else_if": [],
                                                        "else": [],
                                                        "_component_id": "010foavn-0gks-ntq1-hyoy-levpl80aggkj"
                                                    }
                                                },
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\LoopElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "name": null,
                                                        "data_collection": "${status.last_message.tool_calls}",
                                                        "item": "item",
                                                        "elements": [
                                                            {
                                                                "class": "\\Convo\\Pckg\\Core\\Elements\\LogElement",
                                                                "namespace": "convo-core",
                                                                "properties": {
                                                                    "log_message": "ID: ${item.value.id}\n${item.value.function.name}( \n${item.value.function.arguments}\n)",
                                                                    "log_level": "info",
                                                                    "disable_test_view": false,
                                                                    "_component_id": "dn9ilhpu-gij6-irom-vuwx-k29oqn9d2p16"
                                                                }
                                                            }
                                                        ],
                                                        "offset": null,
                                                        "limit": null,
                                                        "loop_until": "",
                                                        "_component_id": "jqviswwp-s50a-negh-spf9-2ef1wkybw7wr"
                                                    }
                                                }
                                            ],
                                            "else_if": [
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\ElseIfElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "test": "${status.last_message.role === 'tool'}",
                                                        "then": [
                                                            {
                                                                "class": "\\Convo\\Pckg\\Core\\Elements\\LogElement",
                                                                "namespace": "convo-core",
                                                                "properties": {
                                                                    "log_message": "${status.last_message.tool_call_id} => ${status.last_message.content}",
                                                                    "log_level": "info",
                                                                    "disable_test_view": false,
                                                                    "_component_id": "zdblrvvd-hgq5-hufz-h7um-7279br1yqtis"
                                                                }
                                                            }
                                                        ],
                                                        "_component_id": "sgcpelum-2g9k-mr4r-2lkp-auzuxktifymy"
                                                    }
                                                }
                                            ],
                                            "else": [
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\TextResponseElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "type": "default",
                                                        "text": "${status.last_message.content}",
                                                        "append": false,
                                                        "alexa_domain": "normal",
                                                        "alexa_emotion": "neutral",
                                                        "alexa_emotion_intensity": "medium",
                                                        "_component_id": "wrdjv9hq-krzd-htkm-pnyz-3ziw8ndckacp"
                                                    }
                                                }
                                            ],
                                            "_component_id": "iaexotrw-htpg-fj72-rapz-vn68u3pvyhvr"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "scope_type": "session",
                                            "parameters": "service",
                                            "properties": {
                                                "messages[${count(messages)}]": "${status.last_message}"
                                            },
                                            "_component_id": "dpe2raif-t8lw-n2ng-bsar-ijould0yg87m"
                                        }
                                    }
                                ],
                                "max_func_result_tokens": "${MAX_FUNCTION_RESULT_SIZE}"
                            }
                        }
                    ],
                    "_component_id": "6gp4wdco-0hwt-vdds-anzo-wxkc8o8iq9jq"
                }
            },
            {
                "class": "\\Convo\\Pckg\\Core\\Elements\\ElementsFragment",
                "namespace": "convo-core",
                "properties": {
                    "fragment_id": "Chat_Context_Main_Prompt",
                    "name": "Chat Context - Main Prompt",
                    "elements": [
                        {
                            "class": "\\Convo\\Gpt\\Pckg\\SystemMessageElement",
                            "namespace": "convo-gpt",
                            "properties": {
                                "content": "You are an advanced AI, intimately integrated within the WordPress and PHP ecosystem, executing operations with precision across a spectrum of system resources.\n\n### **Utilization of Contextual Information**\n\n-   Utilize available contextual information efficiently, ensuring it's current and accurate to maintain operational reliability and effectiveness.\n\n### **Effective Communication**\n\n-   Maintain concise yet comprehensive interactions, mindful of token limits and using historical data for enriched communication and task execution.\n\n### **Operation Logging**\n\n-   Concentrate on logging and including in responses, essential outcomes from each operation. Ensure that generated or utilized IDs, URLs, and paths are accurately logged for enhanced transparency and traceability.      \n\n### **Function Execution**\n\n-   **Function Utilization:** Execute recognized functions from the PHP core, loaded extensions, WordPress core, and plugins, ensuring they are available within the operational environment.\n-   **Error Handling:** Identify and respond to operational errors promptly, providing clear error messages for streamlined issue resolution.\n-   **Strategic Planning:** Plan operations thoughtfully, preemptively acquiring essential data such as IDs to facilitate smooth workflows.\n-   **Optimization:** In post-heavy environments, execute functions discerningly to optimize data retrieval and manipulation efficiency.\n\n### **JSON Handling**\n\n-   Process JSON returns natively, avoiding additional decoding operations.  \n    **Example:** Avoid invoking `json_decode()` function or using `array_slice()` to reduce JSON array responses.\n\n---\n\n_Note: Additional context will follow with specific, up-to-date information to guide the operation further._",
                                "_component_id": "xwpxxfma-xdt2-h7db-s0ve-8ncslhmzatgb"
                            }
                        }
                    ],
                    "_component_id": "pksohovv-tvga-rlop-oz9b-6rgvrwqrkl4j"
                }
            },
            {
                "class": "\\Convo\\Pckg\\Core\\Elements\\ElementsFragment",
                "namespace": "convo-core",
                "properties": {
                    "fragment_id": "Chat_Context_System_Information",
                    "name": "Chat Context - System Information",
                    "elements": [
                        {
                            "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                            "namespace": "convo-core",
                            "properties": {
                                "scope_type": "request",
                                "parameters": "service",
                                "properties": {
                                    "phpversion": "${call_user_func(\"phpversion\")}"
                                },
                                "_component_id": "fei1ljyq-3n9a-xv2z-hwbu-u5yfhya85dp4"
                            }
                        },
                        {
                            "class": "\\Convo\\Gpt\\Pckg\\SystemMessageElement",
                            "namespace": "convo-gpt",
                            "properties": {
                                "content": "## Additional Context: The current user information\n\nThe User is logged in and here is some basic info:\n\n* user id: ${user.ID}\n* name: ${user.data.user_nicename}\n* email: ${user.data.user_email}",
                                "_component_id": "dwyod3cb-trvx-k1wh-zyg9-wyrz3thvpl98"
                            }
                        },
                        {
                            "class": "\\Convo\\Gpt\\Pckg\\SystemMessageElement",
                            "namespace": "convo-gpt",
                            "properties": {
                                "content": "## Additional Context: Date and Time\n\n-   Today is ${date('l jS F Y')}\n-   Tomorrow is ${date('l jS F Y', strtotime('tomorrow'))}\n-   Current time is ${date('h:i:s A')}",
                                "_component_id": "hpqp5xfz-gjnc-0tac-badb-n5nzpzfppee1"
                            }
                        },
                        {
                            "class": "\\Convo\\Gpt\\Pckg\\SystemMessageElement",
                            "namespace": "convo-gpt",
                            "properties": {
                                "content": "## Additional Context: Website system info:\n\n* home_url: ${home_url()}\n* ABSPATH: ${ constant( \"ABSPATH\")}\n* website name: ${ wp_call_user_func( 'get_bloginfo', ['name'] )}\n* PHP version ${phpversion}\n\n### Active theme\n\nslug: ${wp_call_user_func( \"get_template\")}",
                                "_component_id": "sp19eyie-nfvy-qt97-tenw-mdxkr9v1qp5y"
                            }
                        }
                    ],
                    "_component_id": "tc9oi4yv-iyca-k69f-p9fx-sh8aztiblmpq"
                }
            },
            {
                "class": "\\Convo\\Pckg\\Core\\Elements\\ElementsFragment",
                "namespace": "convo-core",
                "properties": {
                    "fragment_id": "Chat_Context_Additional_Instructions",
                    "name": "Chat Context - Additional Instructions",
                    "elements": [
                        {
                            "class": "\\Convo\\Gpt\\Pckg\\SystemMessageElement",
                            "namespace": "convo-gpt",
                            "properties": {
                                "content": "## Additional Context: Specific Tasks Instructions\n\n### Setting Images as Featured\n\nWhen uploading a new image from a URL using the `media_sideload_image()` function, ensure that you set the `return_type` to `id`. This approach allows you to obtain an attachment ID, which is essential for performing subsequent operations on the uploaded image. \n\nTo assign the uploaded image as a featured thumbnail to a specific post, use the set_post_thumbnail() function.",
                                "_component_id": "hhabfj28-fwis-m8wf-89pv-plhr3ker1nso"
                            }
                        }
                    ],
                    "_component_id": "tsa96ry3-snpm-hmb1-clby-47j1wftozcrl"
                }
            },
            {
                "class": "\\Convo\\Pckg\\Core\\Elements\\ElementsFragment",
                "namespace": "convo-core",
                "properties": {
                    "fragment_id": "Chat_Context_Functions",
                    "name": "Chat Context - Functions",
                    "elements": [
                        {
                            "class": "\\Convo\\Gpt\\Pckg\\ChatFunctionElement",
                            "namespace": "convo-gpt",
                            "properties": {
                                "name": "call_user_func_array",
                                "description": "This function stands as a potent gateway, enabling dynamic interaction with the live WordPress and PHP environment. It skillfully encapsulates PHP's native `call_user_func_array()` function, allowing for the direct invocation of PHP functions with an array of arguments, thereby harnessing PHP\u2019s innate capabilities and reflecting immediate changes within the system's operational sphere.\n\nEvery execution will return a JSON object, always featuring a `function_result` field, encapsulating the function's return value. This structured return format ensures a standardized, readable output, simplifying subsequent processing and interpretation.\n\nWhen a function execution concludes due to a thrown exception, the return value will be a JSON object. The exception message can be accessed through the 'error' field in this JSON object.",
                                "parameters": {
                                    "callback": "${{\n  \"oneOf\": [\n    {\n      \"type\": \"string\",\n      \"description\": \"Specifies the name of the global PHP function to be invoked.\"\n    },\n    {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"string\"\n      },\n      \"minItems\": 2,\n      \"maxItems\": 2,\n      \"description\": \"Specifies an array with two elements. The first element is either the name of an object (as a string, e.g., \\\"$wpdb\\\") or a class name. The second element is the method to invoke on that object or class.\"\n    }\n  ],\n  \"description\": \"Specifies the operation to be executed. It can either be a string representing a global PHP function name or an array with two elements. For object method invocations, the first element must be the object name (e.g., \\\"$wpdb\\\" for the WordPress database object), and the second element must be the method name to invoke on that object.\"\n}\n}",
                                    "args": "${{\n        \"type\": \"array\",\n        \"items\": {\n          \"oneOf\": [\n            { \"type\": \"object\" },\n            {\n              \"type\": \"array\",\n              \"items\": {\n                \"oneOf\": [\n                  { \"type\": \"object\" },\n                  { \"type\": \"string\" },\n                  { \"type\": \"number\" },\n                  { \"type\": \"boolean\" },\n                  { \"type\": \"null\" }\n                ]\n              }\n            },\n            { \"type\": \"string\" },\n            { \"type\": \"number\" },\n            { \"type\": \"boolean\" },\n            { \"type\": \"null\" }\n          ]\n        },\n        \"description\": \"Represents an array encapsulating the parameters intended for the specified PHP function. Each element within this array directly corresponds to the arguments accepted by the target function. It\u2019s essential to enclose all parameters within an array to maintain a consistent structure and ensure precise argument delivery, even if there\u2019s only a single argument.\"\n      }}"
                                },
                                "required": "${[\"callback\"]}",
                                "request_data": "data",
                                "result_data": "${function_result}",
                                "ok": [
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "scope_type": "request",
                                            "parameters": "function",
                                            "properties": {
                                                "function_data": "${[]}",
                                                "function_data[\"function_result\"]": "${wp_call_user_func_array( data.callback, data.args)}"
                                            },
                                            "_component_id": "aabkuvdv-qx7v-cvdr-4dtg-jjuewl42zody"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "scope_type": "request",
                                            "parameters": "function",
                                            "properties": {
                                                "function_result": "${function_data}"
                                            },
                                            "_component_id": "ali8cfjc-mkwg-dch2-4ir5-4x3ntzmgj4bz"
                                        }
                                    }
                                ],
                                "_component_id": "elpyhinh-jnfh-giu3-kr1z-3nu0wob0masc",
                                "defaults": "${{\"args\":[]}}"
                            }
                        }
                    ],
                    "_component_id": "e9sx4lcu-c0pa-krx7-v8om-j4iurzks1zis"
                }
            },
            {
                "class": "\\Convo\\Pckg\\Core\\Elements\\ElementsFragment",
                "namespace": "convo-core",
                "properties": {
                    "fragment_id": "Chat_Context_Deep_Research",
                    "name": "Chat Context - Deep Research",
                    "elements": [
                        {
                            "class": "\\Convo\\Gpt\\Pckg\\SystemMessageElement",
                            "namespace": "convo-gpt",
                            "properties": {
                                "content": "## Additional Context: Deep Research\n\n *You can act as an expert deep research assistant. Follow these instructions carefully:*\n \n **1. User Query Handling:**  \n - Record the user's research query exactly as given. This becomes your `initialQuery`.  \n - If the query is broad or unclear, ask clarifying questions to refine the research direction.\n \n **2. Clarification Process:**  \n - For every clarifying question you ask, record the question and the user's answer in this format:\n   ```\n   Q: <clarification question\n   A: <user answer\n   ```\n - Save all these Q\/A pairs as a single serialized string in the `followUps` parameter.\n- Ask questions one by one.\n \n **3. Research Parameters:**  \n   - **Breadth:** How many SERP queries (or search terms) should be generated?  \n     *(Recommended: 3\u201310, default: ${DEFAULT_BREATH})*\n   - **Depth:** How many recursive search iterations should be performed?  \n     *(Recommended: 1\u20135, default: ${DEFAULT_DEPTH})*\n \n **4. Confirmation Step:**  \n - Once you have the initial query, follow-up clarifications, breadth, and depth, summarize these details to the user.  \n - Ask for confirmation with a prompt similar to:  \n   *\"I have gathered the following information for your research:  \n    - **Query:** [initialQuery]  \n    - **Clarifications:** [followUps]  \n    - **Breadth:** [breadth]  \n    - **Depth:** [depth]  \n    This process may take a while. Do you want to proceed? (yes\/no)\"*  \n - Only proceed to call the function if the user confirms.\n \n **5. Function Call Instructions:**  \n - **Never modify the original query.** The `initialQuery` must remain exactly as the user stated it.  \n - All clarifications must be stored in the `followUps` field; do not merge them into the `initialQuery`.  \n - Always include the provided `breadth` and `depth` parameters in your function call.\n \n **Example Interaction:**\n \n **User:** \"How did famous 8-bit programmers end their careers?\"\n \n **Assistant (Clarification):** \"Do you mean programmers from Commodore, Atari, or another era?\"\n \n **User:** \"I'm mostly interested in Commodore.\"\n \n **Assistant (Collecting Parameters):**  \n \"Please specify:\n  - Research breadth (number of search queries) [default: ${DEFAULT_BREATH}]:\n  - Research depth (number of recursive searches) [default: ${DEFAULT_DEPTH}]:\"\n \n **User:** *Provides the values (or accepts defaults).*\n \n **Assistant (Confirmation):**  \n \"You have provided the following details:  \n  - **Initial Query:** 'How did famous 8-bit programmers end their careers?'  \n  - **Clarifications:** 'Q: Do you mean programmers from Commodore, Atari, or another era? A: I'm mostly interested in Commodore.'  \n  - **Breadth:** 4  \n  - **Depth:** 2  \n  \n This research process may take some time. Would you like to proceed? (yes\/no)\"\n \n If the user confirms, then call `deep_research()` with the parameters as shown in the example above.\n \n **Additional Notes:**  \n - Be organized, detailed, and proactive.  \n - Your final output should be a comprehensive markdown report, clearly listing all findings and sources.\n- The result of the `deep_research()` function is automatically saved as a post, with post type `${REPORT_POST_TYPE}` and status `${REPORT_POST_STATUS}`\n\n *By following these instructions, you ensure that all necessary inputs are correctly passed to the deep research engine and that the process only starts with explicit user confirmation.*\n \n \n ### Recursive search\n \n You can also perform recursive search functionality using the `recursive_search()` function. This is a quick way for user to perform multiple searches and get result analysis. \n Note that `depth` and `breath` are optional and by default have ${DEFAULT_DEPTH} and ${DEFAULT_BREATH} values.",
                                "_component_id": "genksz6l-mym5-sjqy-zqto-mtfl9ihbqfhj"
                            }
                        },
                        {
                            "class": "\\Convo\\Gpt\\Pckg\\ChatFunctionElement",
                            "namespace": "convo-gpt",
                            "properties": {
                                "name": "deep_research",
                                "description": "**Function:** `deep_research()`\n\n**Purpose:**  \nPerforms iterative deep research to generate a detailed Markdown report.\n\n**Parameters:**\n\n- **initialQuery (string):**  \n  The user\u2019s original research question (must remain unchanged).\n\n- **followUps (string):**  \n  A serialized string of clarifying Q&A pairs (e.g.,  \n  ```\n  Q: <question>\n  A: <answer>\n  ```  \n  ).\n\n- **breadth (number):**  \n  Number of SERP queries to generate.  \n  *Default:* ${DEFAULT_BREATH} (Recommended: 3\u201310)\n\n- **depth (number):**  \n  Number of recursive search iterations.  \n  *Default:* ${DEFAULT_DEPTH} (Recommended: 1\u20135)\n\n**Note:**  \nEnsure all clarifications are captured only in `followUps`.\n**Before executing, confirm the parameters with the user as this process may take some time.**",
                                "parameters": {
                                    "initialQuery": "${{\n        \"type\": \"string\",\n        \"description\": \"The main research question or topic provided by the user.\"\n      }}",
                                    "followUps": "${{\n        \"type\": \"string\",\n        \"description\": \"Optional. A serialized string containing follow-up questions and user answers gathered during the conversation. Format: 'Q: <question> A: <answer> ...'. Pass an empty string if no follow-ups are needed.\"\n      }}",
                                    "depth": "${{\"type\": \"number\"}}",
                                    "breath": "${{\"type\": \"number\"}}"
                                },
                                "defaults": "${{}}",
                                "required": "${[\"initialQuery\", \"followUps\"]}",
                                "request_data": "data",
                                "result_data": "${function_result}",
                                "ok": [
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "parameters": "function",
                                            "scope_type": "request",
                                            "properties": {
                                                "query": "Initial Query: ${data.initialQuery}"
                                            },
                                            "_component_id": "p00qgtbv-ca8k-7jch-dgms-iewp2srrxyya"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\IfElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "test": "${data.followUps}",
                                            "then": [
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "parameters": "function",
                                                        "scope_type": "request",
                                                        "properties": {
                                                            "query": "${query}\n\nFollow-up Questions and Answers: ${data.followUps}"
                                                        },
                                                        "_component_id": "eectgs1w-deqh-rdvw-dqx6-o6v4xxmreauq"
                                                    }
                                                }
                                            ],
                                            "else_if": [],
                                            "else": [],
                                            "_component_id": "spdtgb5s-enuo-2l7u-4uyg-vs1dmsss4ovs"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\LogElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "log_message": "Full query:\n${query}",
                                            "log_level": "info",
                                            "disable_test_view": false,
                                            "_component_id": "axefutzc-x2bn-htjz-5ftf-kimpk6h6g3fw"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "parameters": "function",
                                            "scope_type": "request",
                                            "properties": {
                                                "result": "${ recursive_research( query, data.depth, data.breath)}",
                                                "final": "${final_report(prompt, result.learnings, result.visited_urls)}"
                                            },
                                            "_component_id": "g9q44lhc-jdhy-mfax-r2af-at51hg3p5qqx"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "parameters": "function",
                                            "scope_type": "request",
                                            "properties": {
                                                "function_result": "${final}\n\n\n## Sources\n\n${ implode(\"\\n\", result.visited_urls)}"
                                            },
                                            "_component_id": "ppbn487l-8pjm-egmk-elg5-k8shrtedkeln"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "parameters": "function",
                                            "scope_type": "request",
                                            "properties": {
                                                "post_id": "${save_report(data.initialQuery, function_result)}"
                                            },
                                            "_component_id": "9forx4jb-t6z6-xysi-6ppf-aak367gbpdiz"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "parameters": "function",
                                            "scope_type": "request",
                                            "properties": {
                                                "function_result": "${function_result}\n\n\n## Saved in database\n\n- post ID: ${post_id}\n- post title: ${data.initialQuery}"
                                            },
                                            "_component_id": "hfaso94d-fsjd-erb4-fxjq-ryrhdk1coojp"
                                        }
                                    }
                                ],
                                "_component_id": "xljcgwx5-vqkt-cnar-pk7v-hd3usrojwtbn"
                            }
                        },
                        {
                            "class": "\\Convo\\Gpt\\Pckg\\ChatFunctionElement",
                            "namespace": "convo-gpt",
                            "properties": {
                                "name": "recursive_search",
                                "description": "This function performs search, analyzes results and returns findings.\n\n**Parameters:**\n\n- **query(string):**  \n  The initial search query that should be performed. It can be exact user's query, but it can also be adjusted to get better results.\n\n- **breadth (number):**  \n  Number of SERP queries to generate.  \n  *Default:* ${DEFAULT_BREATH} (Recommended: 3\u201310)\n\n- **depth (number):**  \n  Number of recursive search iterations.  \n  *Default:* ${DEFAULT_DEPTH} (Recommended: 1\u20135)",
                                "parameters": {
                                    "query": "${{\n        \"type\": \"string\",\n        \"description\": \"The main research question or topic provided by the user.\"\n      }}",
                                    "depth": "${{\"type\": \"number\"}}",
                                    "breath": "${{\"type\": \"number\"}}"
                                },
                                "defaults": "${{}}",
                                "required": "${[\"initialQuery\", \"followUps\"]}",
                                "request_data": "data",
                                "result_data": "${function_result}",
                                "ok": [
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "parameters": "function",
                                            "scope_type": "request",
                                            "properties": {
                                                "function_result": "${ recursive_research( data.query, data.depth, data.breath)}"
                                            },
                                            "_component_id": "jwjyhrw9-agvf-ai3f-tuki-nbkdn45avvfj"
                                        }
                                    }
                                ],
                                "_component_id": "yiei56cl-krzf-jbl0-kyhs-z7osmwq8p8qj"
                            }
                        }
                    ],
                    "_component_id": "kgss3g9r-xzrw-aaqd-ku7l-6qwxabsdvish"
                }
            },
            {
                "class": "\\Convo\\Pckg\\Core\\Elements\\ElementsFragment",
                "namespace": "convo-core",
                "properties": {
                    "fragment_id": "Inc_Functions",
                    "name": "DR - Functions",
                    "elements": [
                        {
                            "class": "\\Convo\\Pckg\\Core\\Elements\\NamedFunctionElement",
                            "namespace": "convo-core",
                            "properties": {
                                "name": "recursive_research",
                                "function_args": {
                                    "query": "",
                                    "depth": "${DEFAULT_DEPTH}",
                                    "breath": "${DEFAULT_BREATH}",
                                    "learnings": "${[]}",
                                    "visited_urls": "${[]}"
                                },
                                "result_data": "${function_result}",
                                "ok": [
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\IfElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "test": "${!breath}",
                                            "then": [
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "parameters": "function",
                                                        "scope_type": "request",
                                                        "properties": {
                                                            "function_result": "${{\"learnings\": learnings, \"visited_urls\": visited_urls}}"
                                                        },
                                                        "_component_id": "xt2ji0fx-lkan-unrw-6upw-lav1g0xnsfqg"
                                                    }
                                                },
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\LogElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "log_message": "recursive research - no breath - returning same ..\n\n${print_r(analysis)}",
                                                        "log_level": "info",
                                                        "disable_test_view": false,
                                                        "_component_id": "n2mphjwi-ysth-ykbx-g4aw-bjlekaxysvmv"
                                                    }
                                                }
                                            ],
                                            "else_if": [],
                                            "else": [
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\LogElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "log_message": "recursive search - depth: ${depth} \/ breath: ${breath}\n${query}\n${print_r( learnings)}\n${print_r( visited_urls)}",
                                                        "log_level": "info",
                                                        "disable_test_view": false,
                                                        "_component_id": "nokhdeu3-47qj-txko-uric-baui1rff486l"
                                                    }
                                                },
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "parameters": "function",
                                                        "scope_type": "request",
                                                        "properties": {
                                                            "queries": "${ generate_serp_queries( query, breath, learnings)}"
                                                        },
                                                        "_component_id": "xcbskz9i-2qra-rc2g-yjqi-lzilxcsputhz"
                                                    }
                                                },
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\LoopElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "name": null,
                                                        "data_collection": "${queries.queries}",
                                                        "item": "item",
                                                        "elements": [
                                                            {
                                                                "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                                                "namespace": "convo-core",
                                                                "properties": {
                                                                    "parameters": "function",
                                                                    "scope_type": "request",
                                                                    "properties": {
                                                                        "results": "${ firecrawl_search( item.value.query)}"
                                                                    },
                                                                    "_component_id": "qjsmtknw-rwzs-sg2v-3icd-vaic42bmyuj6"
                                                                }
                                                            },
                                                            {
                                                                "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                                                "namespace": "convo-core",
                                                                "properties": {
                                                                    "parameters": "function",
                                                                    "scope_type": "request",
                                                                    "properties": {
                                                                        "analysis": "${ analyze_results( item.value.query, results)}"
                                                                    },
                                                                    "_component_id": "3m3ukfxk-fvp4-ic9o-16ru-occtccdkxiux"
                                                                }
                                                            },
                                                            {
                                                                "class": "\\Convo\\Pckg\\Core\\Elements\\LogElement",
                                                                "namespace": "convo-core",
                                                                "properties": {
                                                                    "log_message": "analysis for: ${item.value.query} - ${item.value.researchGoal}\n\n${print_r(analysis)}",
                                                                    "log_level": "info",
                                                                    "disable_test_view": false,
                                                                    "_component_id": "ziiu3rxh-fyhx-oqod-8jan-hxrngsjt26ly"
                                                                }
                                                            },
                                                            {
                                                                "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                                                "namespace": "convo-core",
                                                                "properties": {
                                                                    "parameters": "function",
                                                                    "scope_type": "request",
                                                                    "properties": {
                                                                        "learnings": "${ array_merge( learnings, analysis.learnings)}",
                                                                        "visited_urls": "${ array_merge( visited_urls, array_column( results.data, \"url\"))}"
                                                                    },
                                                                    "_component_id": "tccu4dpg-0kcc-i4kd-cvfy-2akxkctcjoqm"
                                                                }
                                                            },
                                                            {
                                                                "class": "\\Convo\\Pckg\\Core\\Elements\\IfElement",
                                                                "namespace": "convo-core",
                                                                "properties": {
                                                                    "test": "${ depth > 1}",
                                                                    "then": [
                                                                        {
                                                                            "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                                                            "namespace": "convo-core",
                                                                            "properties": {
                                                                                "parameters": "function",
                                                                                "scope_type": "request",
                                                                                "properties": {
                                                                                    "next_query": "Previous research goal: ${item.value.researchGoal}\nFollow-up research directions: ${implode( \"\\n\", analysis.followUpQuestions)}"
                                                                                },
                                                                                "_component_id": "htvggckj-pd4w-2aj4-u5ab-2mwe48ibvcgd"
                                                                            }
                                                                        },
                                                                        {
                                                                            "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                                                            "namespace": "convo-core",
                                                                            "properties": {
                                                                                "parameters": "function",
                                                                                "scope_type": "request",
                                                                                "properties": {
                                                                                    "function_result": "${recursive_research( next_query, depth - 1, ceil(breadth \/ 2), learnings, visited_urls)}"
                                                                                },
                                                                                "_component_id": "awimzb3f-loil-s2vq-f0dl-6omh5nktsiqn"
                                                                            }
                                                                        }
                                                                    ],
                                                                    "else_if": [],
                                                                    "else": [
                                                                        {
                                                                            "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                                                            "namespace": "convo-core",
                                                                            "properties": {
                                                                                "parameters": "function",
                                                                                "scope_type": "request",
                                                                                "properties": {
                                                                                    "function_result": "${{\"learnings\": learnings, \"visited_urls\": visited_urls}}"
                                                                                },
                                                                                "_component_id": "0mak05uo-0gai-5wlw-0qvx-wodivhxvlfhf"
                                                                            }
                                                                        }
                                                                    ],
                                                                    "_component_id": "otfioghr-5jxz-wwbi-tdor-yq0tbwmqnr6a"
                                                                }
                                                            }
                                                        ],
                                                        "offset": null,
                                                        "limit": null,
                                                        "loop_until": "",
                                                        "_component_id": "rqhjdjjq-lfkq-9omg-nj84-ifvqycxhryw0"
                                                    }
                                                },
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "parameters": "function",
                                                        "scope_type": "request",
                                                        "properties": {
                                                            "function_result": "${{\"learnings\": learnings, \"visited_urls\": visited_urls}}"
                                                        },
                                                        "_component_id": "jyx7bynr-6e6y-1uhm-rd9w-vyp87fegg5xu"
                                                    }
                                                },
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\LogElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "log_message": "recursive search DONE - depth: ${depth} \/ breath: ${breath}\n${query}\n${print_r( learnings)}\n${print_r( visited_urls)}",
                                                        "log_level": "info",
                                                        "disable_test_view": false,
                                                        "_component_id": "0jsgfhhf-t5hy-tdoc-i9az-bxvvcgpwnnfv"
                                                    }
                                                }
                                            ],
                                            "_component_id": "ewnts19k-jx5y-3hsi-utyy-z3uapbp8qcbj"
                                        }
                                    }
                                ],
                                "_component_id": "9em8zj0n-cej5-ehmy-ysnm-qwotntbpi7e2"
                            }
                        },
                        {
                            "class": "\\Convo\\Pckg\\Core\\Elements\\NamedFunctionElement",
                            "namespace": "convo-core",
                            "properties": {
                                "name": "generate_serp_queries",
                                "function_args": {
                                    "query": "",
                                    "numQueries": "${DEFAULT_BREATH}",
                                    "learnings": "${[]}"
                                },
                                "result_data": "${function_result}",
                                "ok": [
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\IfElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "test": "${!is_numeric( numQueries) || !numQueries}",
                                            "then": [
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\LogElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "log_message": "Invalid count in generate SERPs ${numQueries}",
                                                        "log_level": "info",
                                                        "disable_test_view": false,
                                                        "_component_id": "lnsatdcc-2yii-ccac-a5qc-6ftpbizvdffh"
                                                    }
                                                },
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\EndRequestElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "_component_id": "hv204xjd-ryvf-hmlc-yzfn-bilrb7ddfsfi"
                                                    }
                                                }
                                            ],
                                            "else_if": [],
                                            "else": [],
                                            "_component_id": "lsgshk1z-xc67-q81k-grtl-7fa36ufidysc"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\LogElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "log_message": "Generating ${numQueries} SERP queries for \"${query}\"",
                                            "log_level": "info",
                                            "disable_test_view": false,
                                            "_component_id": "pkgjtoug-sl7e-ij1n-xjgn-psa93jdmbo8k"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "parameters": "function",
                                            "scope_type": "request",
                                            "properties": {
                                                "response_format": "${{\"type\":\"json_schema\",\"json_schema\":{\"name\":\"serp_queries\",\"schema\":{\"type\":\"object\",\"properties\":{\"queries\":{\"type\":\"array\",\"description\":\"List of generated SERP queries for research.\",\"items\":{\"type\":\"object\",\"properties\":{\"query\":{\"type\":\"string\",\"description\":\"The search query to be used in a search engine.\"},\"researchGoal\":{\"type\":\"string\",\"description\":\"Description of the research goal this query is meant to achieve. Includes additional directions for further research.\"}},\"required\":[\"query\",\"researchGoal\"],\"additionalProperties\":false}}},\"required\":[\"queries\"],\"additionalProperties\":false},\"strict\":true}}}"
                                            },
                                            "_component_id": "nnvsoj3i-i0aj-xmtd-i6h3-efr0zpgbprib"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Gpt\\Pckg\\ChatCompletionV2Element",
                                        "namespace": "convo-gpt",
                                        "properties": {
                                            "result_var": "status",
                                            "api_key": "${GPT_API_KEY}",
                                            "apiOptions": {
                                                "model": "${DEFAULT_MODEL}",
                                                "response_format": "${response_format}",
                                                "reasoning_effort": "${REASONING_EFFORT}"
                                            },
                                            "ok": [],
                                            "_component_id": "fube9vhj-xzs0-ylbk-n9hd-rkxh66d9pb03",
                                            "functions": [],
                                            "message_provider": [
                                                {
                                                    "class": "\\Convo\\Gpt\\Pckg\\SystemMessageGroupElement",
                                                    "namespace": "convo-gpt",
                                                    "properties": {
                                                        "trim_children": false,
                                                        "message_provider": [
                                                            {
                                                                "class": "\\Convo\\Pckg\\Core\\Elements\\ReadElementsFragment",
                                                                "namespace": "convo-core",
                                                                "properties": {
                                                                    "fragment_id": "System_Prompt",
                                                                    "_component_id": "qjiyiqg8-qqwi-h8hq-8he7-zdkoxeunxzxn"
                                                                }
                                                            },
                                                            {
                                                                "class": "\\Convo\\Pckg\\Core\\Elements\\ReadElementsFragment",
                                                                "namespace": "convo-core",
                                                                "properties": {
                                                                    "fragment_id": "DR_Generate_SERPs_Prompt",
                                                                    "_component_id": "apwgfyd4-foka-tyln-mxcz-rvnao1kq4q8f"
                                                                }
                                                            }
                                                        ],
                                                        "_component_id": "p51c2ehv-h6bk-zkhe-jyhk-prq9gb2ljxhb"
                                                    }
                                                }
                                            ],
                                            "new_message_flow": [
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\LogElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "log_message": "Search queries: ${status.last_message.content}",
                                                        "log_level": "info",
                                                        "disable_test_view": false,
                                                        "_component_id": "ymafyria-qa5b-rvjn-7gwz-bzhgmfxjfdpk"
                                                    }
                                                },
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "parameters": "function",
                                                        "scope_type": "request",
                                                        "properties": {
                                                            "function_result": "${json_decode( status.last_message.content, true)}"
                                                        },
                                                        "_component_id": "1taa7axg-ng5x-rrc2-bfqs-s3ut4jjyyiip"
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                ],
                                "_component_id": "ct6ywya8-doqx-nwrd-celv-ndtmuxqg1xtg"
                            }
                        },
                        {
                            "class": "\\Convo\\Pckg\\Core\\Elements\\NamedFunctionElement",
                            "namespace": "convo-core",
                            "properties": {
                                "name": "firecrawl_search",
                                "function_args": {
                                    "query": "",
                                    "limit": "${SEARCH_RESULTS_COUNT}"
                                },
                                "result_data": "${function_result}",
                                "ok": [
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\LogElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "log_message": "Searching results for query \"${query}\" results. Limit ${limit}",
                                            "log_level": "info",
                                            "disable_test_view": false,
                                            "_component_id": "dofhlinx-rmxn-ib3y-j73v-wupqcrwusd4y"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "parameters": "function",
                                            "scope_type": "request",
                                            "properties": {
                                                "data": "${{\"query\":query,\"limit\":limit,\"tbs\":\"\",\"lang\":\"en\",\"country\":\"us\",\"location\":\"\",\"timeout\":15000,\"scrapeOptions\":{\"formats\":[\"markdown\"]}}}"
                                            },
                                            "_component_id": "yh2ul4uj-o98x-bgfq-tvei-rmdvxejfmdfb"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\HttpQueryElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "scope_type": "request",
                                            "parameters": "service",
                                            "name": "response",
                                            "url": "${FIRECRAWL_API_BASE_URL}\/v1\/search",
                                            "content_type": "AUTO",
                                            "method": "POST",
                                            "cache_timeout": 0,
                                            "timeout": 300,
                                            "headers": {
                                                "Authorization": "Bearer ${FIRECRAWL_API_KEY}"
                                            },
                                            "params": [],
                                            "body": "${json_encode( data)}",
                                            "ok": [
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "parameters": "function",
                                                        "scope_type": "request",
                                                        "properties": {
                                                            "function_result": "${response.body}"
                                                        },
                                                        "_component_id": "nyhx2or2-cjh8-ewtx-u2ja-po3lidbgw7qw"
                                                    }
                                                }
                                            ],
                                            "nok": [
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\LogElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "log_message": "firecrawl search: ${response.error}",
                                                        "log_level": "info",
                                                        "disable_test_view": false,
                                                        "_component_id": "mzw83bkw-llhc-8hvy-db9a-fyjxwgadxzwt"
                                                    }
                                                }
                                            ],
                                            "_component_id": "eoxtmcxo-ksgj-avak-rcbj-zpyggtvmx2tl"
                                        }
                                    }
                                ],
                                "_component_id": "jsk451j2-a2vq-rjfb-itvj-qej3bk6o2vmc"
                            }
                        },
                        {
                            "class": "\\Convo\\Pckg\\Core\\Elements\\NamedFunctionElement",
                            "namespace": "convo-core",
                            "properties": {
                                "name": "analyze_results",
                                "function_args": {
                                    "query": "",
                                    "results": ""
                                },
                                "result_data": "${function_result}",
                                "ok": [
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\LogElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "log_message": "Analysing query \"${query}\" results.",
                                            "log_level": "info",
                                            "disable_test_view": false,
                                            "_component_id": "ktx4zvqi-wpmk-7lsb-tgnp-k6fpls1wizrk"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "parameters": "function",
                                            "scope_type": "request",
                                            "properties": {
                                                "response_format": "${{\"type\":\"json_schema\",\"json_schema\":{\"name\":\"analyze_results\",\"schema\":{\"type\":\"object\",\"properties\":{\"learnings\":{\"type\":\"array\",\"description\":\"List of key insights extracted from the web search results.\",\"items\":{\"type\":\"string\",\"description\":\"A concise, information-dense learning extracted from the content.\"}},\"followUpQuestions\":{\"type\":\"array\",\"description\":\"List of follow-up questions to continue the research process.\",\"items\":{\"type\":\"string\",\"description\":\"A research question generated based on the extracted learnings.\"}}},\"required\":[\"learnings\",\"followUpQuestions\"],\"additionalProperties\":false},\"strict\":true}}}"
                                            },
                                            "_component_id": "mxw6i5lc-4dog-b7pf-ozvn-hk3lmk4blxbn"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Gpt\\Pckg\\ChatCompletionV2Element",
                                        "namespace": "convo-gpt",
                                        "properties": {
                                            "result_var": "status",
                                            "api_key": "${GPT_API_KEY}",
                                            "apiOptions": {
                                                "model": "${DEFAULT_MODEL}",
                                                "response_format": "${response_format}",
                                                "reasoning_effort": "${REASONING_EFFORT}"
                                            },
                                            "ok": [],
                                            "_component_id": "infbpeez-yiiy-mdic-pikg-unijaulzalbe",
                                            "functions": [],
                                            "message_provider": [
                                                {
                                                    "class": "\\Convo\\Gpt\\Pckg\\SystemMessageGroupElement",
                                                    "namespace": "convo-gpt",
                                                    "properties": {
                                                        "trim_children": false,
                                                        "message_provider": [
                                                            {
                                                                "class": "\\Convo\\Pckg\\Core\\Elements\\ReadElementsFragment",
                                                                "namespace": "convo-core",
                                                                "properties": {
                                                                    "fragment_id": "System_Prompt",
                                                                    "_component_id": "kwcm9lmk-mr3n-drl9-ohrl-jmkikj44sgc0"
                                                                }
                                                            },
                                                            {
                                                                "class": "\\Convo\\Pckg\\Core\\Elements\\ReadElementsFragment",
                                                                "namespace": "convo-core",
                                                                "properties": {
                                                                    "fragment_id": "DR_Analyze_Results_Prompt",
                                                                    "_component_id": "oqcjcqxc-yolh-h6wg-5eot-mbj1slpvy5ek"
                                                                }
                                                            }
                                                        ],
                                                        "_component_id": "5nfh1q6y-hpxv-xfgg-nyp0-sdcqvce981xz"
                                                    }
                                                }
                                            ],
                                            "new_message_flow": [
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\LogElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "log_message": "Search queries: ${status.last_message.content}",
                                                        "log_level": "info",
                                                        "disable_test_view": false,
                                                        "_component_id": "t3myftjf-wqob-gc3s-i9ra-rrqnojtq5e2l"
                                                    }
                                                },
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "parameters": "function",
                                                        "scope_type": "request",
                                                        "properties": {
                                                            "function_result": "${json_decode( status.last_message.content, true)}"
                                                        },
                                                        "_component_id": "vmvbgejp-gkhg-llac-w9yo-vqggrjdkhevq"
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                ],
                                "_component_id": "plihxans-b7zj-2tmi-kxv1-psiobl7hcty2"
                            }
                        },
                        {
                            "class": "\\Convo\\Pckg\\Core\\Elements\\NamedFunctionElement",
                            "namespace": "convo-core",
                            "properties": {
                                "name": "final_report",
                                "function_args": {
                                    "prompt": "",
                                    "learnings": "",
                                    "visited_urls": ""
                                },
                                "result_data": "${function_result}",
                                "ok": [
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "parameters": "function",
                                            "scope_type": "request",
                                            "properties": {
                                                "learnings_string": ""
                                            },
                                            "_component_id": "s6zcrt14-qfih-qico-m3aa-barj24xzovct"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\LoopElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "name": "Learnings as string",
                                            "data_collection": "${learnings}",
                                            "item": "item",
                                            "elements": [
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "parameters": "function",
                                                        "scope_type": "request",
                                                        "properties": {
                                                            "learnings_string": "${learnings_string}\n<learning>${item.value}<\/learning>"
                                                        },
                                                        "_component_id": "xpaqbnwn-meer-d95a-jykg-kmf211bj5e0g"
                                                    }
                                                }
                                            ],
                                            "offset": null,
                                            "limit": null,
                                            "loop_until": "",
                                            "_component_id": "yrj4dias-cm1j-xvjz-irlh-iqc4n5iovmfj"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Gpt\\Pckg\\ChatCompletionV2Element",
                                        "namespace": "convo-gpt",
                                        "properties": {
                                            "result_var": "status",
                                            "api_key": "${GPT_API_KEY}",
                                            "apiOptions": {
                                                "model": "${DEFAULT_MODEL}",
                                                "reasoning_effort": "${REASONING_EFFORT}"
                                            },
                                            "ok": [],
                                            "_component_id": "8l0tjw91-dari-lxmj-qrwu-rqqqzl6ucpq2",
                                            "functions": [],
                                            "message_provider": [
                                                {
                                                    "class": "\\Convo\\Gpt\\Pckg\\SystemMessageGroupElement",
                                                    "namespace": "convo-gpt",
                                                    "properties": {
                                                        "trim_children": false,
                                                        "message_provider": [
                                                            {
                                                                "class": "\\Convo\\Pckg\\Core\\Elements\\ReadElementsFragment",
                                                                "namespace": "convo-core",
                                                                "properties": {
                                                                    "fragment_id": "System_Prompt",
                                                                    "_component_id": "6tfmzx7p-x3sb-xpmm-fvih-okkhhhotgz5j"
                                                                }
                                                            },
                                                            {
                                                                "class": "\\Convo\\Pckg\\Core\\Elements\\ReadElementsFragment",
                                                                "namespace": "convo-core",
                                                                "properties": {
                                                                    "fragment_id": "DR_Final_Report_Prompt",
                                                                    "_component_id": "rj5g7iw4-luhe-wwr4-ojsr-pkiyajaiuhrw"
                                                                }
                                                            }
                                                        ],
                                                        "_component_id": "0sxavdl6-haya-uwdz-oncv-aloajnmqmaa1"
                                                    }
                                                }
                                            ],
                                            "new_message_flow": [
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\LogElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "log_message": "Search queries: ${status.last_message.content}",
                                                        "log_level": "info",
                                                        "disable_test_view": false,
                                                        "_component_id": "veegytw6-4awx-3tdm-kjp3-yf4pzeiou9y5"
                                                    }
                                                },
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "parameters": "function",
                                                        "scope_type": "request",
                                                        "properties": {
                                                            "function_result": "${status.last_message.content}"
                                                        },
                                                        "_component_id": "3o526ijw-psid-msla-auxt-uvdsx9q6gfrr"
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                ],
                                "_component_id": "79jv5ia9-6cfo-0m18-bjwt-lnv3bd9e2oqh"
                            }
                        },
                        {
                            "class": "\\Convo\\Pckg\\Core\\Elements\\NamedFunctionElement",
                            "namespace": "convo-core",
                            "properties": {
                                "name": "save_report",
                                "function_args": {
                                    "query": "",
                                    "content": ""
                                },
                                "result_data": "${function_result}",
                                "ok": [
                                    {
                                        "class": "\\Convo\\Wp\\Pckg\\WpCore\\WpInsertPostElement",
                                        "namespace": "convo-wp-core",
                                        "properties": {
                                            "created_post_var": "status",
                                            "fire_after_hooks": true,
                                            "post_args": {
                                                "post_type": "${REPORT_POST_TYPE}",
                                                "post_title": "${query}",
                                                "post_content": "${content}",
                                                "post_status": "${REPORT_POST_STATUS}"
                                            },
                                            "post_tax_input": [],
                                            "post_meta_input": [],
                                            "on_success": [
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "parameters": "function",
                                                        "scope_type": "request",
                                                        "properties": {
                                                            "function_result": "${status.post.ID}"
                                                        },
                                                        "_component_id": "fwligvur-j0hw-hbws-5rmx-9ulfrockreia"
                                                    }
                                                }
                                            ],
                                            "on_failure": [
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "parameters": "function",
                                                        "scope_type": "request",
                                                        "properties": {
                                                            "function_result": "${false}"
                                                        },
                                                        "_component_id": "owfyz4s5-umg2-jjul-higv-vw5uwetpngcc"
                                                    }
                                                }
                                            ],
                                            "_component_id": "hubalzo2-dp9s-bc8q-xpoz-ziv1dudxifhm"
                                        }
                                    }
                                ],
                                "_component_id": "r0nnipi1-gbfo-x4ku-arf6-d0trlg76hnge"
                            }
                        },
                        {
                            "class": "\\Convo\\Pckg\\Core\\Elements\\NamedFunctionElement",
                            "namespace": "convo-core",
                            "properties": {
                                "name": "trim_prompt",
                                "function_args": {
                                    "content": ""
                                },
                                "result_data": "${function_result}",
                                "ok": [
                                    {
                                        "class": "\\Convo\\Gpt\\Pckg\\ChatCompletionV2Element",
                                        "namespace": "convo-gpt",
                                        "properties": {
                                            "result_var": "status",
                                            "api_key": "${GPT_API_KEY}",
                                            "apiOptions": {
                                                "model": "${DEFAULT_UTIL_MODEL}",
                                                "temperature": "${DEFAULT_TEMPERATURE}",
                                                "max_tokens": "${DEFAULT_MAX_TOKENS}"
                                            },
                                            "ok": [],
                                            "_component_id": "khhw2fuj-qpkq-vqlj-xeji-gvm1hjkeraxi",
                                            "functions": [],
                                            "message_provider": [
                                                {
                                                    "class": "\\Convo\\Gpt\\Pckg\\SystemMessageElement",
                                                    "namespace": "convo-gpt",
                                                    "properties": {
                                                        "content": "You will be provided with a scrapped web page in markdown format. As this is was a full page scrape, besides the main content, markdown contains also menus, advertisements and other irrelevant data.\nYour role is to provide just the main content as markdown.",
                                                        "_component_id": "4bqeabty-ndop-ppzr-q2bv-fqgbnlzj4igq"
                                                    }
                                                },
                                                {
                                                    "class": "\\Convo\\Gpt\\Pckg\\SystemMessageElement",
                                                    "namespace": "convo-gpt",
                                                    "properties": {
                                                        "content": "${content}",
                                                        "_component_id": "unvaytxh-xtfv-kbgs-hskp-ngoikbn3qgrk"
                                                    }
                                                }
                                            ],
                                            "new_message_flow": [
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "parameters": "function",
                                                        "scope_type": "request",
                                                        "properties": {
                                                            "function_result": "${status.last_message.content}"
                                                        },
                                                        "_component_id": "ypxamp7g-c8sn-ifec-jvs2-rgw8vppxn4l6"
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                ],
                                "_component_id": "9dzyjkkd-p6w5-dv5s-ksns-jtuddgqc2gvy"
                            }
                        }
                    ],
                    "_component_id": "hkitxhlt-2lam-mve6-uijf-dzmrnl04kgsw"
                }
            },
            {
                "class": "\\Convo\\Pckg\\Core\\Elements\\ElementsFragment",
                "namespace": "convo-core",
                "properties": {
                    "fragment_id": "System_Prompt",
                    "name": "DR - System Prompt",
                    "elements": [
                        {
                            "class": "\\Convo\\Gpt\\Pckg\\SystemMessageElement",
                            "namespace": "convo-gpt",
                            "properties": {
                                "content": "You are an expert researcher. Today is ${date('l jS F Y')}. Follow these instructions when responding:\n  - You may be asked to research subjects that is after your knowledge cutoff, assume the user is right when presented with news.\n  - The user is a highly experienced analyst, no need to simplify it, be as detailed as possible and make sure your response is correct.\n  - Be highly organized.\n  - Suggest solutions that I didn't think about.\n  - Be proactive and anticipate my needs.\n  - Treat me as an expert in all subject matter.\n  - Mistakes erode my trust, so be accurate and thorough.\n  - Provide detailed explanations, I'm comfortable with lots of detail.\n  - Value good arguments over authorities, the source is irrelevant.\n  - Consider new technologies and contrarian ideas, not just the conventional wisdom.\n  - You may use high levels of speculation or prediction, just flag it for me.",
                                "_component_id": "j9v61txq-2n4m-kffi-vxf8-xoid5xymabhw"
                            }
                        }
                    ],
                    "_component_id": "oc4pcicw-pbbu-neio-64bu-zj0ldi1a4fyq"
                }
            },
            {
                "class": "\\Convo\\Pckg\\Core\\Elements\\ElementsFragment",
                "namespace": "convo-core",
                "properties": {
                    "fragment_id": "DR_Generate_SERPs_Prompt",
                    "name": "DR - Generate SERPs Prompt",
                    "elements": [
                        {
                            "class": "\\Convo\\Gpt\\Pckg\\SystemMessageElement",
                            "namespace": "convo-gpt",
                            "properties": {
                                "content": "Given the following prompt from the user, generate a list of SERP queries to research the topic. Return a maximum of ${numQueries} queries, but feel free to return less if the original prompt is clear. Make sure each query is unique and not similar to each other: \n\n<prompt>${query}<\/prompt>",
                                "_component_id": "yy56654c-0jdm-cnck-nwyi-xqdik4kdu21r"
                            }
                        },
                        {
                            "class": "\\Convo\\Pckg\\Core\\Elements\\IfElement",
                            "namespace": "convo-core",
                            "properties": {
                                "test": "${ count( learnings)}",
                                "then": [
                                    {
                                        "class": "\\Convo\\Gpt\\Pckg\\SystemMessageElement",
                                        "namespace": "convo-gpt",
                                        "properties": {
                                            "content": "Here are some learnings from previous research, use them to generate more specific queries: ${implode(\"\\n\", learnings)}",
                                            "_component_id": "m3zexgzj-oknv-j6mz-9wbz-dusjsblfdwwy"
                                        }
                                    }
                                ],
                                "else_if": [],
                                "else": [],
                                "_component_id": "0lckg6kt-j2lr-2roe-zfea-7kjtssd1fktl"
                            }
                        }
                    ],
                    "_component_id": "l9vpzfek-jd2s-wyf4-onbg-x77iitdizveo"
                }
            },
            {
                "class": "\\Convo\\Pckg\\Core\\Elements\\ElementsFragment",
                "namespace": "convo-core",
                "properties": {
                    "fragment_id": "DR_Analyze_Results_Prompt",
                    "name": "DR - Analyze Results Prompt",
                    "elements": [
                        {
                            "class": "\\Convo\\Gpt\\Pckg\\SystemMessageElement",
                            "namespace": "convo-gpt",
                            "properties": {
                                "content": "Given the following contents from a SERP search for the query <query>${query}<\/query>, generate a list of learnings from the contents. Return a maximum of 3 learnings, but feel free to return less if the contents are clear. Make sure each learning is unique and not similar to each other. The learnings should be concise and to the point, as detailed and information dense as possible. Make sure to include any entities like people, places, companies, products, things, etc. in the learnings, as well as any exact metrics, numbers, or dates. The learnings will be used to research the topic further.",
                                "_component_id": "jbxdo4ia-xj5m-jdm3-dyvc-hwewyuuyn6x4"
                            }
                        },
                        {
                            "class": "\\Convo\\Pckg\\Core\\Elements\\LoopElement",
                            "namespace": "convo-core",
                            "properties": {
                                "name": null,
                                "data_collection": "${results.data}",
                                "item": "item",
                                "elements": [
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "parameters": "function",
                                            "scope_type": "request",
                                            "properties": {
                                                "tokens_count": "${ estimate_tokens( item.value.markdown) }"
                                            },
                                            "_component_id": "wkjlmlhk-iiw7-rrqh-mqex-klxwgtdpw26u"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\IfElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "test": "${ tokens_count < MAX_TOKENS}",
                                            "then": [
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\LogElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "log_message": "Adding page \"${item.value.title}\" \nUrl: ${item.value.url}",
                                                        "log_level": "info",
                                                        "disable_test_view": false,
                                                        "_component_id": "s15yducc-oiwo-yhgh-ditj-aq3diffcxc7b"
                                                    }
                                                },
                                                {
                                                    "class": "\\Convo\\Gpt\\Pckg\\SystemMessageElement",
                                                    "namespace": "convo-gpt",
                                                    "properties": {
                                                        "content": "<contents>${ trim_prompt( item.value.markdown)}<\/contents>",
                                                        "_component_id": "bezfpwhl-danx-hmuf-ye38-igatwzdnhwcb"
                                                    }
                                                }
                                            ],
                                            "else_if": [],
                                            "else": [
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\LogElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "log_message": "Skipping to large page, ${tokens_count} tokens -  \"${item.value.title}\" \nUrl: ${item.value.url}",
                                                        "log_level": "warning",
                                                        "disable_test_view": false,
                                                        "_component_id": "caqbfonf-bdf9-rla0-18rc-ywajkfij6b0y"
                                                    }
                                                }
                                            ],
                                            "_component_id": "5j3lxnmd-ommi-mhza-pz35-xsatzts4xwcs"
                                        }
                                    }
                                ],
                                "offset": null,
                                "limit": null,
                                "loop_until": "",
                                "_component_id": "pk800drr-dgvb-clwb-mioe-7sltpmqewzxm"
                            }
                        }
                    ],
                    "_component_id": "aknwz7ex-quno-s5cs-gqqr-88fi939cz9hj"
                }
            },
            {
                "class": "\\Convo\\Pckg\\Core\\Elements\\ElementsFragment",
                "namespace": "convo-core",
                "properties": {
                    "fragment_id": "DR_Final_Report_Prompt",
                    "name": "DR - Final Report Prompt",
                    "elements": [
                        {
                            "class": "\\Convo\\Gpt\\Pckg\\SystemMessageElement",
                            "namespace": "convo-gpt",
                            "properties": {
                                "content": "Given the following prompt from the user, write a final report on the topic using the learnings from research. Make it as as detailed as possible, aim for 3 or more pages, include ALL the learnings from research:\n\n<prompt>${prompt}<\/prompt>\n\nHere are all the learnings from previous research:\n<learnings>${learnings_string}<\/learnings>",
                                "_component_id": "7ve3nd9m-f02p-9jwf-x0ls-5tv8zqpz01cy"
                            }
                        }
                    ],
                    "_component_id": "h7t1imeg-l7oj-twcm-logn-woxtixpf7ije"
                }
            },
            {
                "class": "\\Convo\\Pckg\\Core\\Elements\\ElementsFragment",
                "namespace": "convo-core",
                "properties": {
                    "fragment_id": "Inc_Check_API_Key",
                    "name": "Inc - Check API Key",
                    "elements": [
                        {
                            "class": "\\Convo\\Pckg\\Core\\Elements\\IfElement",
                            "namespace": "convo-core",
                            "properties": {
                                "test": "${ empty( GPT_API_KEY)}",
                                "then": [
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\TextResponseElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "type": "default",
                                            "text": "Your GPT API key is not set. Please navigate to the Variables view and enter value for the `GPT_API_KEY` service variable.",
                                            "append": false,
                                            "alexa_domain": "normal",
                                            "alexa_emotion": "neutral",
                                            "alexa_emotion_intensity": "medium",
                                            "_component_id": "edvgxzkv-xsli-flq7-hy6f-x6mbj8a65xwd"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\EndRequestElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "_component_id": "h4b8xw2n-jejm-a2dk-edqo-4up3rk8nvwoi"
                                        }
                                    }
                                ],
                                "else_if": [],
                                "else": [],
                                "_component_id": "ccgm9xlq-dmyg-jf2r-rit2-kkvkve19fypr"
                            }
                        }
                    ],
                    "_component_id": "f7taop8h-bpaj-7krp-y0uu-uls8wbi8nuf4"
                }
            }
        ],
        "properties": []
    }
}
