{
    "template_id": "mcp-server-example",
    "name": "MCP Server Example",
    "description": "MCP Server template containing several example usages.",
    "service": {
        "convo_service_version": 40,
        "packages": [
            "convo-core",
            "convo-wp-core",
            "convo-gpt"
        ],
        "contexts": [],
        "variables": [],
        "preview_variables": [],
        "entities": [],
        "intents": [],
        "blocks": [
            {
                "class": "\\Convo\\Pckg\\Core\\Elements\\SpecialRoleProcessorBlock",
                "namespace": "convo-core",
                "properties": {
                    "block_id": "MCP_Server",
                    "name": "MCP Server",
                    "role": "mcp-server",
                    "processors": [
                        {
                            "class": "\\Convo\\Gpt\\Pckg\\McpServerProcessor",
                            "namespace": "convo-gpt",
                            "properties": {
                                "name": "WP MCP Server",
                                "version": "1.0",
                                "tools": [
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\ReadElementsFragment",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "fragment_id": "Functions",
                                            "_component_id": "flgoban1-vd50-lrzg-3rhd-2t76gpfjaq2g"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\ReadElementsFragment",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "fragment_id": "Example_3_External_functions",
                                            "_component_id": "opnqcued-9y6b-mrm2-ig7a-rck674iyy624"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Gpt\\Pckg\\SimpleMcpPromptTemplate",
                                        "namespace": "convo-gpt",
                                        "properties": {
                                            "name": "meta_desc",
                                            "description": "Generate a 155 character SEO description",
                                            "arguments": "${[{\"name\": \"postId\", \"description\": \"WP post ID\", required: true}]}",
                                            "prompt": "Create an engaging 155\u2011character meta description for the post ${postId}.",
                                            "_component_id": "yejtchmu-sszk-ddb4-i426-t6juvkd0l63a"
                                        }
                                    }
                                ],
                                "_component_id": "6p0uigl8-lbqp-8if5-diuw-xwwvijqgfbtf"
                            }
                        }
                    ],
                    "failback": [],
                    "_component_id": "b9th0mg2-ymeo-hhkt-orif-ozjcafiqs2a0"
                }
            },
            {
                "class": "\\Convo\\Pckg\\Core\\Elements\\ConversationBlock",
                "namespace": "convo-core",
                "properties": {
                    "role": "error_handler",
                    "block_id": "Error_handler",
                    "name": "Error handler",
                    "pre_dispatch": [],
                    "elements": [
                        {
                            "class": "\\Convo\\Pckg\\Core\\Elements\\LogElement",
                            "namespace": "convo-core",
                            "properties": {
                                "log_message": "${error.getMessage()}",
                                "_component_id": "pqamtg9p-fdnj-tvdq-1ckm-3ynp5zznvg2n"
                            }
                        }
                    ],
                    "processors": [],
                    "fallback": [],
                    "_component_id": "701jr3fq-gior-sdop-w9or-cdgglgnvp1k8"
                }
            }
        ],
        "fragments": [
            {
                "class": "\\Convo\\Pckg\\Core\\Elements\\ElementsFragment",
                "namespace": "convo-core",
                "properties": {
                    "fragment_id": "Chat_Context_Functions",
                    "name": "Chat Context - Functions",
                    "elements": [
                        {
                            "class": "\\Convo\\Gpt\\Pckg\\ChatFunctionElement",
                            "namespace": "convo-gpt",
                            "properties": {
                                "name": "call_user_func_array",
                                "description": "This function stands as a potent gateway, enabling dynamic interaction with the live WordPress and PHP environment. It skillfully encapsulates PHP's native `call_user_func_array()` function, allowing for the direct invocation of PHP functions with an array of arguments, thereby harnessing PHP\u2019s innate capabilities and reflecting immediate changes within the system's operational sphere.\n\nEvery execution will return a JSON object, always featuring a `function_result` field, encapsulating the function's return value. This structured return format ensures a standardized, readable output, simplifying subsequent processing and interpretation.\n\nWhen a function execution concludes due to a thrown exception, the return value will be a JSON object. The exception message can be accessed through the 'error' field in this JSON object.",
                                "parameters": {
                                    "callback": "${{\n  \"oneOf\": [\n    {\n      \"type\": \"string\",\n      \"description\": \"Specifies the name of the global PHP function to be invoked.\"\n    },\n    {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"string\"\n      },\n      \"minItems\": 2,\n      \"maxItems\": 2,\n      \"description\": \"Specifies an array with two elements. The first element is either the name of an object (as a string, e.g., \\\"$wpdb\\\") or a class name. The second element is the method to invoke on that object or class.\"\n    }\n  ],\n  \"description\": \"Specifies the operation to be executed. It can either be a string representing a global PHP function name or an array with two elements. For object method invocations, the first element must be the object name (e.g., \\\"$wpdb\\\" for the WordPress database object), and the second element must be the method name to invoke on that object.\"\n}\n}",
                                    "args": "${{\n        \"type\": \"array\",\n        \"items\": {\n          \"oneOf\": [\n            { \"type\": \"object\" },\n            {\n              \"type\": \"array\",\n              \"items\": {\n                \"oneOf\": [\n                  { \"type\": \"object\" },\n                  { \"type\": \"string\" },\n                  { \"type\": \"number\" },\n                  { \"type\": \"boolean\" },\n                  { \"type\": \"null\" }\n                ]\n              }\n            },\n            { \"type\": \"string\" },\n            { \"type\": \"number\" },\n            { \"type\": \"boolean\" },\n            { \"type\": \"null\" }\n          ]\n        },\n        \"description\": \"Represents an array encapsulating the parameters intended for the specified PHP function. Each element within this array directly corresponds to the arguments accepted by the target function. It\u2019s essential to enclose all parameters within an array to maintain a consistent structure and ensure precise argument delivery, even if there\u2019s only a single argument.\"\n      }}"
                                },
                                "required": "${[\"callback\"]}",
                                "request_data": "data",
                                "result_data": "${function_result}",
                                "ok": [
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "scope_type": "request",
                                            "parameters": "function",
                                            "properties": {
                                                "function_data": "${[]}",
                                                "function_data[\"function_result\"]": "${wp_call_user_func_array( data.callback, data.args)}"
                                            },
                                            "_component_id": "aabkuvdv-qx7v-cvdr-4dtg-jjuewl42zody"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "scope_type": "request",
                                            "parameters": "function",
                                            "properties": {
                                                "function_result": "${function_data}"
                                            },
                                            "_component_id": "ali8cfjc-mkwg-dch2-4ir5-4x3ntzmgj4bz"
                                        }
                                    }
                                ],
                                "_component_id": "elpyhinh-jnfh-giu3-kr1z-3nu0wob0masc",
                                "defaults": "${{\"args\":[]}}"
                            }
                        },
                        {
                            "class": "\\Convo\\Gpt\\Pckg\\ChatFunctionElement",
                            "namespace": "convo-gpt",
                            "properties": {
                                "name": "generate_post_excerpt",
                                "description": "This function generates excerpt for a given post.",
                                "parameters": {
                                    "post_id": "${{\"type\": \"number\", \"description\": \"ID of the post that excerpt should be generated for\"}}",
                                    "prompt": "${{\"type\": \"string\", \"description\": \"Additional instruction how excerpt should be formed\"}}"
                                },
                                "defaults": "${{}}",
                                "required": "${[\"post_id\"]}",
                                "request_data": "data",
                                "result_data": "${function_result}",
                                "ok": [
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "parameters": "function",
                                            "scope_type": "request",
                                            "properties": {
                                                "POST": "${get_post( data.post_id)}"
                                            },
                                            "_component_id": "6qncyhvq-xp2r-bogh-e1q4-ipxpi81ws2xf"
                                        }
                                    },
                                    {
                                        "class": "\\Convo\\Gpt\\Pckg\\ChatCompletionV2Element",
                                        "namespace": "convo-gpt",
                                        "properties": {
                                            "result_var": "status",
                                            "api_key": "${GPT_API_KEY}",
                                            "apiOptions": {
                                                "model": "${DEFAULT_MODEL}",
                                                "temperature": "${DEFAULT_TEMPERATURE}",
                                                "max_tokens": "${DEFAULT_MAX_TOKENS}"
                                            },
                                            "ok": [],
                                            "_component_id": "cy7tvh12-ynbg-u12q-bcaw-xmohvkkwx410",
                                            "functions": [],
                                            "message_provider": [
                                                {
                                                    "class": "\\Convo\\Gpt\\Pckg\\SystemMessageGroupElement",
                                                    "namespace": "convo-gpt",
                                                    "properties": {
                                                        "trim_children": false,
                                                        "message_provider": [
                                                            {
                                                                "class": "\\Convo\\Gpt\\Pckg\\SystemMessageElement",
                                                                "namespace": "convo-gpt",
                                                                "properties": {
                                                                    "content": "You are SEO AI assistant on the WordPress website. Your role is to generate excerpt for a given post.",
                                                                    "_component_id": "d6en9mdh-hrre-fqg2-0jv5-xzajtft2rpjb"
                                                                }
                                                            },
                                                            {
                                                                "class": "\\Convo\\Pckg\\Core\\Elements\\IfElement",
                                                                "namespace": "convo-core",
                                                                "properties": {
                                                                    "test": "${data.prompt}",
                                                                    "then": [
                                                                        {
                                                                            "class": "\\Convo\\Gpt\\Pckg\\SystemMessageElement",
                                                                            "namespace": "convo-gpt",
                                                                            "properties": {
                                                                                "content": "${data.prompt}",
                                                                                "_component_id": "fe7xo0od-9snw-nuuo-c3cl-s5zcmnfmnjyr"
                                                                            }
                                                                        }
                                                                    ],
                                                                    "else_if": [],
                                                                    "else": [],
                                                                    "_component_id": "b6owaisl-guuo-hifo-rhpm-88nwgcqsvjuy"
                                                                }
                                                            }
                                                        ],
                                                        "_component_id": "pnba5prl-ekft-bxxk-yuhc-mwv8qcn8q6fh"
                                                    }
                                                },
                                                {
                                                    "class": "\\Convo\\Gpt\\Pckg\\SystemMessageElement",
                                                    "namespace": "convo-gpt",
                                                    "properties": {
                                                        "content": "The post to generate excerpt for:\n\n**${POST.post_title}**\n\n${html_to_markdown( POST.post_content)}",
                                                        "_component_id": "ujhso703-tgsy-4diz-arke-tbdl7awfwcek"
                                                    }
                                                }
                                            ],
                                            "new_message_flow": [
                                                {
                                                    "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                                    "namespace": "convo-core",
                                                    "properties": {
                                                        "scope_type": "session",
                                                        "parameters": "function",
                                                        "properties": {
                                                            "function_result": "${status.last_message.content}"
                                                        },
                                                        "_component_id": "e72k6lvc-mqii-5nil-b6bq-w2sjgnwewkko"
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                ],
                                "_component_id": "ymx5jop5-m5j6-p3lk-b3hn-3uk4i3vapok2"
                            }
                        }
                    ],
                    "_component_id": "e9sx4lcu-c0pa-krx7-v8om-j4iurzks1zis"
                }
            },
            {
                "class": "\\Convo\\Pckg\\Core\\Elements\\ElementsFragment",
                "namespace": "convo-core",
                "properties": {
                    "fragment_id": "Functions",
                    "name": "Functions - Polyfill",
                    "elements": [
                        {
                            "class": "\\Convo\\Pckg\\Core\\Elements\\NamedFunctionElement",
                            "namespace": "convo-core",
                            "properties": {
                                "name": "wp_set_current_user",
                                "function_args": {
                                    "id": ""
                                },
                                "result_data": "${function_result}",
                                "ok": [
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "parameters": "function",
                                            "scope_type": "request",
                                            "properties": {
                                                "function_result": "${wp_call_user_func('wp_set_current_user', [id])}"
                                            },
                                            "_component_id": "kssrrcql-g9vc-lwmj-o7rn-ah6fc7dqnx9p"
                                        }
                                    }
                                ],
                                "_component_id": "rrrq0b1i-ew83-zxme-6ycq-h0lbaxdygyxp"
                            }
                        },
                        {
                            "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                            "namespace": "convo-core",
                            "properties": {
                                "parameters": "service",
                                "scope_type": "request",
                                "properties": {
                                    "ret": "${wp_set_current_user( 1)}"
                                },
                                "_component_id": "1s5c91fh-3gne-kqbz-gbqe-mith23v52xep"
                            }
                        }
                    ],
                    "_component_id": "wedxt5im-nnpv-j877-bcrq-1kix8nteg8ee"
                }
            },
            {
                "class": "\\Convo\\Pckg\\Core\\Elements\\ElementsFragment",
                "namespace": "convo-core",
                "properties": {
                    "fragment_id": "Example_1_No_Code_Functions",
                    "name": "Example 1 - No Code Functions",
                    "elements": [
                        {
                            "class": "\\Convo\\Gpt\\Pckg\\ChatFunctionElement",
                            "namespace": "convo-gpt",
                            "properties": {
                                "name": "say_hello",
                                "description": "Returns welcome message for a given name.",
                                "parameters": {
                                    "name": "${{\"type\":\"string\"}}"
                                },
                                "defaults": "${{}}",
                                "required": "${[\"name\"]}",
                                "request_data": "data",
                                "result_data": "${function_result}",
                                "ok": [
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "parameters": "function",
                                            "scope_type": "request",
                                            "properties": {
                                                "function_result": "Hello my friend, ${data.name}"
                                            },
                                            "_component_id": "imfqshb4-yol9-f08t-szdj-kethh2bk8did"
                                        }
                                    }
                                ],
                                "_component_id": "nxkipmtz-ylo9-e25u-qdii-dspyeyiz0bt7"
                            }
                        }
                    ],
                    "_component_id": "zqgeknrv-d3fr-yfmc-96jg-krxwg9ryjv6n"
                }
            },
            {
                "class": "\\Convo\\Pckg\\Core\\Elements\\ElementsFragment",
                "namespace": "convo-core",
                "properties": {
                    "fragment_id": "Example_2_WP_REST_Proxy_call",
                    "name": "Example 2 - WP REST Proxy call",
                    "elements": [
                        {
                            "class": "\\Convo\\Gpt\\Pckg\\WpRestProxyFunction",
                            "namespace": "convo-gpt",
                            "properties": {
                                "name": "list_posts_manual",
                                "description": "Lists all posts with filtering, sorting, and pagination options",
                                "parameters": {
                                    "page": "${{ \"type\": \"number\", \"description\": \"Page number (default 1)\" }}",
                                    "per_page": "${{ \"type\": \"number\", \"description\": \"Items per page (default 10, max 100)\" }}",
                                    "search": "${{ \"type\": \"string\", \"description\": \"Search term for post content or title\" }}",
                                    "after": "${{ \"type\": \"string\", \"description\": \"ISO8601 date string to get posts published after this date\" }}",
                                    "author": "${{ \"type\": \"number\", \"description\": \"Author ID\" }}",
                                    "categories": "${{ \"type\": \"array\", \"items\": { \"type\": \"number\" }, \"description\": \"Category IDs\" }}",
                                    "tags": "${{ \"type\": \"array\", \"items\": { \"type\": \"number\" }, \"description\": \"Tag IDs\" }}",
                                    "status": "${{ \"type\": \"string\", \"enum\": [\"publish\", \"future\", \"draft\", \"pending\", \"private\"], \"description\": \"Post status\" }}",
                                    "orderby": "${{ \"type\": \"string\", \"enum\": [\"date\", \"id\", \"include\", \"title\", \"slug\", \"modified\"], \"description\": \"Sort posts by parameter\" }}",
                                    "order": "${{ \"type\": \"string\", \"enum\": [\"asc\", \"desc\"], \"description\": \"Order direction\" }}"
                                },
                                "required": "${[]}",
                                "defaults": "${{\"per_page\": 10, \"status\": \"publish\"}}",
                                "method": "GET",
                                "endpoint": "posts",
                                "pagination": true,
                                "_component_id": "ftv5tpeb-rlia-3qtx-0sf2-9kff8h9kyg5o",
                                "_use_var_parameters": false
                            }
                        }
                    ],
                    "_component_id": "nkdnwh9d-gxkt-6g3f-lofc-xd26xyykythn"
                }
            },
            {
                "class": "\\Convo\\Pckg\\Core\\Elements\\ElementsFragment",
                "namespace": "convo-core",
                "properties": {
                    "fragment_id": "Example_3_External_functions",
                    "name": "Example 3 - External functions",
                    "elements": [
                        {
                            "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                            "namespace": "convo-core",
                            "properties": {
                                "parameters": "service",
                                "scope_type": "request",
                                "properties": {
                                    "ACTIVE_REST_APIS": "${[\"convo_mcp_register_wp_comments\", \"convo_mcp_register_wp_media\", \"convo_mcp_register_wp_pages\", \"convo_mcp_register_wp_plugins\", \"convo_mcp_register_wp_posts\", \"convo_mcp_register_wp_settings\", \"convo_mcp_register_wp_taxonomies\", \"convo_mcp_register_wp_users\"]}",
                                    "chat_functions": "${[]}"
                                },
                                "_component_id": "p6xgzcno-09ko-f9yr-midu-ixdwxe1czuo2"
                            }
                        },
                        {
                            "class": "\\Convo\\Pckg\\Core\\Elements\\LoopElement",
                            "namespace": "convo-core",
                            "properties": {
                                "name": null,
                                "data_collection": "${ACTIVE_REST_APIS}",
                                "item": "item",
                                "elements": [
                                    {
                                        "class": "\\Convo\\Pckg\\Core\\Elements\\SetParamElement",
                                        "namespace": "convo-core",
                                        "properties": {
                                            "scope_type": "request",
                                            "parameters": "service",
                                            "properties": {
                                                "chat_functions": "${apply_filters(item.value, chat_functions, _workflowComponent)}"
                                            },
                                            "_component_id": "xupj6i1q-oykk-ppkx-ehdg-ta3e2tk2c8gk"
                                        }
                                    }
                                ],
                                "offset": null,
                                "limit": null,
                                "loop_until": "",
                                "_component_id": "oc7ooyah-nlei-86vt-24at-f4weymm0zmev"
                            }
                        },
                        {
                            "class": "\\Convo\\Pckg\\Core\\Elements\\LoopElement",
                            "namespace": "convo-core",
                            "properties": {
                                "data_collection": "${chat_functions}",
                                "item": "gpt_function",
                                "elements": [
                                    {
                                        "class": "\\Convo\\Gpt\\Pckg\\ExternalChatFunctionElement",
                                        "namespace": "convo-gpt",
                                        "properties": {
                                            "name": "${gpt_function.value.name}",
                                            "description": "${gpt_function.value.description}",
                                            "parameters": "${gpt_function.value.parameters}",
                                            "required": "${gpt_function.value.required}",
                                            "_component_id": "22kuzmgv-x7cg-xzog-t6it-r46fshovollv",
                                            "execute": "${gpt_function.value.execute}",
                                            "defaults": "${gpt_function.value.defaults}"
                                        }
                                    }
                                ],
                                "offset": null,
                                "limit": null,
                                "loop_until": "",
                                "_component_id": "0wg34ake-omaf-osv2-aewb-brwjb2r5mtna"
                            }
                        }
                    ],
                    "_component_id": "uxltzmeg-phzg-zno6-sh8f-gey5lf6u46sx"
                }
            }
        ],
        "properties": [],
        "configurations": []
    }
}
